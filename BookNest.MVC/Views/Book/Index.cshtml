@model BookNest.MVC.ViewModels.BookIndexVM

@{
    ViewData["Title"] = "Browse Books";
}

<style>
    /* Səhifəyə özəl dizaynlar */
    .browse-header {
        text-align: center;
        padding: 40px 0;
        border-bottom: 1px solid #E0DCD0;
        margin-bottom: 40px;
    }

        .browse-header h1 {
            font-family: var(--font-serif);
            font-size: 36px;
            margin-bottom: 20px;
        }

    /* Axtarış Qutusu */
    .main-search-form {
        display: flex;
        justify-content: center;
        max-width: 600px;
        margin: 0 auto;
        gap: 10px;
    }

        .main-search-form input {
            flex: 1;
            padding: 15px 25px;
            border-radius: 30px;
            border: 1px solid #E0DCD0;
            background: var(--white);
            font-size: 15px;
            outline: none;
        }

        .main-search-form button {
            background: var(--text-dark);
            color: #fff;
            border: none;
            padding: 0 30px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

            .main-search-form button:hover {
                opacity: 0.8;
            }

    /* Layout: Sol menyu və Sağ grid */
    .browse-layout {
        display: flex;
        gap: 40px;
    }

    /* Sol Sidebar (Janrlar) */
    .sidebar {
        width: 250px;
        flex-shrink: 0;
    }

        .sidebar h3 {
            font-family: var(--font-serif);
            font-size: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--text-dark);
            padding-bottom: 10px;
            display: inline-block;
        }

    .genre-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

        .genre-list a {
            font-size: 14px;
            color: var(--text-gray);
            transition: 0.2s;
            position: relative;
            padding-left: 15px;
        }

            .genre-list a:hover {
                color: var(--text-dark);
                font-weight: 600;
            }

            .genre-list a.active {
                color: var(--text-dark);
                font-weight: 700;
            }
                
                .genre-list a.active::before {
                    content: '▸';
                    position: absolute;
                    left: 0;
                    color: var(--primary-gold);
                }

    /* Kitablar Qridi */
    .book-grid-container {
        flex-grow: 1;
    }

    .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 30px;
        margin-bottom: 50px;
    }

    /* Kitab Kartı */
    .browse-card {
        background: var(--white);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        box-shadow: var(--shadow);
        transition: 0.3s;
        position: relative;
    }

        .browse-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .browse-card img {
            width: 100%;
            height: 260px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .browse-card h4 {
            font-family: var(--font-serif);
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-dark);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .browse-card p {
            font-size: 13px;
            color: #B38B59;
            font-style: italic;
            margin-bottom: 10px;
        }

        .browse-card .stars {
            color: var(--primary-gold);
            font-size: 14px;
            margin-bottom: 15px;
        }

    .add-btn {
        display: block;
        width: 100%;
        background: var(--bg-body);
        border: 1px solid var(--text-dark);
        color: var(--text-dark);
        padding: 8px 0;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
    }

        .add-btn:hover {
            background: var(--text-dark);
            color: #fff;
        }

    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 40px;
    }

    .page-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #E0DCD0;
        color: var(--text-gray);
        font-size: 14px;
        font-weight: 500;
        transition: 0.2s;
    }

        .page-btn:hover {
            background: var(--bg-section);
            color: var(--text-dark);
        }

        .page-btn.active {
            background: var(--text-dark);
            color: #fff;
            border-color: var(--text-dark);
            pointer-events: none;
        }

        .page-btn.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
</style>

<div class="container">

    <div class="browse-header">
        <h1>Explore Books</h1>

        <form asp-action="Index" method="get" class="main-search-form">
            @if (Model.CurrentGenreId.HasValue)
            {
                <input type="hidden" name="genreId" value="@Model.CurrentGenreId" />
            }
            <input type="text" name="search" value="@Model.CurrentSearch" placeholder="Search by title, author or keyword...">
            <button type="submit">Search</button>
        </form>
    </div>

    <div class="browse-layout">

        <aside class="sidebar">
            <h3>Categories</h3>
            <div class="genre-list">
                <a asp-action="Index" asp-route-search="@Model.CurrentSearch"
                   class="@(!Model.CurrentGenreId.HasValue ? "active" : "")">
                    All Books
                </a>

                @foreach (var genre in Model.Genres)
                {
                    <a asp-action="Index"
                       asp-route-genreId="@genre.Id"
                       asp-route-search="@Model.CurrentSearch"
                       class="@(Model.CurrentGenreId == genre.Id ? "active" : "")">
                        @genre.Name
                    </a>
                }
            </div>
        </aside>

        <main class="book-grid-container">

            @if (Model.Books.Count == 0)
            {
                <div style="text-align:center; padding: 50px; color: var(--text-gray);">
                    <h2>No books found.</h2>
                    <p>Try adjusting your search or filter criteria.</p>
                </div>
            }
            else
            {
                <div class="books-grid">
                    @foreach (var book in Model.Books)
                    {
                        <div class="browse-card">
                            <a asp-controller="Home" asp-action="Details" asp-route-id="@book.Id">
                                <img src="~/uploads/books/@book.ImageUrl" alt="@book.Title">
                            </a>
                            <h4>@book.Title</h4>
                            <p>@(book.BookAuthors.FirstOrDefault()?.Author.FullName ?? "Unknown Author")</p>
                            <div class="stars">★★★★★</div>
                            <button class="add-btn">+ Add to List</button>
                        </div>
                    }
                </div>

                @if (Model.Books.TotalPages > 1)
                {
                    <div class="pagination-container">
                        <a asp-action="Index"
                           asp-route-page="@(Model.Books.PageIndex - 1)"
                           asp-route-search="@Model.CurrentSearch"
                           asp-route-genreId="@Model.CurrentGenreId"
                           class="page-btn @(!Model.Books.HasPreviousPage ? "disabled" : "")">
                            &laquo; Prev
                        </a>

                        @for (int i = 1; i <= Model.Books.TotalPages; i++)
                        {
                            <a asp-action="Index"
                               asp-route-page="@i"
                               asp-route-search="@Model.CurrentSearch"
                               asp-route-genreId="@Model.CurrentGenreId"
                               class="page-btn @(i == Model.Books.PageIndex ? "active" : "")">
                                @i
                            </a>
                        }

                        <a asp-action="Index"
                           asp-route-page="@(Model.Books.PageIndex + 1)"
                           asp-route-search="@Model.CurrentSearch"
                           asp-route-genreId="@Model.CurrentGenreId"
                           class="page-btn @(!Model.Books.HasNextPage ? "disabled" : "")">
                            Next &raquo;
                        </a>
                    </div>
                }
            }
        </main>
    </div>
</div>